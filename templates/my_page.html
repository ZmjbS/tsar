{% extends "tsar.html" %}
{% load humanize %}

{% block head %}
<style>
.overflow { display: none; }
</style>
<script type="text/javascript" src="/static/js/tsar.events.js"></script>
<script>

function getnews(sel, url, number=5) {
	var newsdata = $.get("/news/", { url: url, num: number, }, function(data) {
		obj = JSON && JSON.parse(data) || $.parseJSON(data);
		console.log( "success"+data);
		console.log(obj);
		console.log( "success"+obj[0].title);
		list = ""
		for (count in obj) {
			entry = obj[count]
			console.log(entry.title)
			list = list+'<li><a href="'+ entry.link +'">'+ entry.title +'</a> <time datetime="'+entry.published+'">'+ entry.published_parsed +'</time></li>';
		}
		$(sel).html('<ul>'+list+'</ul>');
		})
		.done(function() {
			console.log( "second success" );
		})
		.fail(function() {
			alert( "error" );
		})
		.always(function(data) {
			obj = JSON && JSON.parse(data) || $.parseJSON(data);
			console.log( "finished" );
		});
		console.log('posted')
}

$(document).ready(function(){
   $('.event_responder').click(function(event) { event.stopPropagation(); respond_to_event(this, 'My page'); } );

	console.log('posting');
	getnews('#hssr_news', 'http://hssr.is/?feed=rss2');
	getnews('#sl_news', 'http://landsbjorg.is/Rss.aspx?CatID=466');
});
</script>
{% endblock %}

{% block content %}
<div class="row">
	<div class="col-md-6"><!-- 1 of 2 columns -->
		<section id="vidburdir">
			<button type="button" class="btn btn-default pull-right" onclick="$('.notinvited').toggle();$('.overflow').toggle();$(this).toggleClass('active');"><i class="fa fa-user"></i></button>
			<h2>Næstu viðburðir</h2>
			<ul id="events" class="events_list list-unstyled">
{% for ed in events_dictionaries_list %}
				<li id="event-{{ ed.event.id }}" class="event-list-item{% if not ed.invitedroles_dictionaries_list %} notinvited{% else %}{%if forloop.counter > event_list_length %} overflow{% endif %}{% endif %}"
	{% if ed.invitedroles_dictionaries_list %}
			onclick="
				if ($('#event_{{ ed.event.id }}_roles_list').is(':visible')) {
					$('#event_{{ ed.event.id }}_roles_list').hide();
					// Using .show() and .hide() on the response icon blocks causes some rendering problems so we'll change the visibility instead.
					$('#event_{{ ed.event.id }}_response_icons').css('visibility', 'visible');
					$(this).css('padding-bottom', '0');
					//$(this).css('background-color', '#fff');
				} else {
					$('#event_{{ ed.event.id }}_roles_list').show();
					// Using .show() and .hide() on the response icon blocks causes some rendering problems so we'll change the visibility instead.
					$('#event_{{ ed.event.id }}_response_icons').css('visibility', 'hidden');
					$(this).css('padding-bottom', '.4em');
					//$(this).css('background-color', '#eef');
				};
				$(this).children('span.status-icon').toggleClass('fa-circle fa-circle-o');"{% endif %}>
				<span id="event_{{ ed.event.id }}_status_icon" 
	{% if ed.invitedroles_dictionaries_list %}
		{% if ed.positive_response %}
					class="fa fa-circle status-icon attending-icon"
		{% else %}
			{% if ed.unanswered_response %}
					class="fa fa-circle status-icon unclear-icon"
			{% else %}
					class="fa fa-circle status-icon absent-icon"
			{% endif %}
		{% endif %}
	{% else %}
					class="fa fa-circle-o status-icon notinvited-icon"
	{% endif %}
				></span>

				<a href="/vidburdur/{{ ed.id }}/" onclick="event.stopPropagation()">{{ ed.event.title }}</a>
				<time datetime='{{ed.event.date_time_begin|date:"Y-m-d"}}'>{{ ed.event.date_time_begin|naturaltime }}</time>
				<span id="event_{{ ed.event.id }}_response_icons" class="response-icons"
	{% if ed.invitedroles_dictionaries_list|length == 1 %}
					data-eventrole="{{ ed.invitedroles_dictionaries_list.0.eventrole.id }}">

		{% if ed.positive_response %}
					<span id="absent-{{ ed.invitedroles_dictionaries_list.0.eventrole.id }}" data-member_id="{{ user.id }}" data-eventrole_id="{{ ed.invitedroles_dictionaries_list.0.eventrole.id }}" data-action="absent" class="event_responder fa fa-times-circle"></span>
					<span id="unclea-{{ ed.invitedroles_dictionaries_list.0.eventrole.id }}" data-member_id="{{ user.id }}" data-eventrole_id="{{ ed.invitedroles_dictionaries_list.0.eventrole.id }}" data-action="unclear" class="event_responder fa fa-question-circle"></span>
		{% else %}
			{% if ed.unanswered_response %}
					<span id="absent-{{ ed.invitedroles_dictionaries_list.0.eventrole.id }}" data-member_id="{{ user.id }}" data-eventrole_id="{{ ed.invitedroles_dictionaries_list.0.eventrole.id }}" data-action="absent" class="event_responder fa fa-times-circle"></span>
					<span id="attend-{{ ed.invitedroles_dictionaries_list.0.eventrole.id }}" data-member_id="{{ user.id }}" data-eventrole_id="{{ ed.invitedroles_dictionaries_list.0.eventrole.id }}" data-action="attend" class="event_responder fa fa-plus-circle"></span>
			{% else %}
					<span id="unclea-{{ ed.invitedroles_dictionaries_list.0.eventrole.id }}" data-member_id="{{ user.id }}" data-eventrole_id="{{ ed.invitedroles_dictionaries_list.0.eventrole.id }}" data-action="unclear" class="event_responder fa fa-question-circle"></span>
					<span id="attend-{{ ed.invitedroles_dictionaries_list.0.eventrole.id }}" data-member_id="{{ user.id }}" data-eventrole_id="{{ ed.invitedroles_dictionaries_list.0.eventrole.id }}" data-action="attend" class="event_responder fa fa-plus-circle"></span>
			{% endif %}
		{% endif %}
	{% else %}
					>
		{% if ed.invitedroles_dictionaries_list|length > 1 %}
						<span style="float: right; color: #ccc;">{{ ed.invitedroles_dictionaries_list|length }} hlutverk</span>
		{% endif %}
	{% endif %}
					</span>
					<ul id="event_{{ ed.event.id }}_roles_list" class="roles_list">
	{% for ird in ed.invitedroles_dictionaries_list %}
						<li id="eventrole_{{ird.eventrole.id }}" class="eventrole-list-item">
							<span id="eventrole_{{ ird.eventrole.id }}_status_icon"
		{% if ird.response == 'Y' %}
								data-status="attending" class="fa fa-circle status-icon" style="color: rgb(70, 136, 71); cursor: default; margin: 0;"
		{% else %}
			{% if ird.response == 'N' %}
								data-status="absent" class="fa fa-circle status-icon" style="color: rgb(185, 74, 72); cursor: default; margin: 0;"
			{% else %}
								data-status="unclear" class="fa fa-circle status-icon" style="color: rgb(248, 148, 6); cursor: default; margin: 0;"
			{% endif %}
		{% endif %}
							></span>

			{{ ird.eventrole.role }}

							<span id="eventrole_{{ ird.eventrole.id }}_response_icons" data-eventrole="{{ ird.eventrole.id }}" class="response-icons">
		{% if ird.response == 'Y' %}
					<span id="eventrole-unclea-{{ ird.eventrole.id }}" data-member_id="{{ user.id }}" data-eventrole_id="{{ ird.eventrole.id }}" data-action="unclear" class="event_responder fa fa-question-circle"></span>
					<span id="eventrole-absent-{{ ird.eventrole.id }}" data-member_id="{{ user.id }}" data-eventrole_id="{{ ird.eventrole.id }}" data-action="absent"  class="event_responder fa fa-times-circle"></span>
		{% else %}
			{% if ird.response == 'N' %}
					<span id="eventrole-attend-{{ ird.eventrole.id }}" data-member_id="{{ user.id }}" data-eventrole_id="{{ ird.eventrole.id }}" data-action="attend"  class="event_responder fa fa-plus-circle"></span>
					<span id="eventrole-unclea-{{ ird.eventrole.id }}" data-member_id="{{ user.id }}" data-eventrole_id="{{ ird.eventrole.id }}" data-action="unclear" class="event_responder fa fa-question-circle"></span>
			{% else %}
					<span id="eventrole-attend-{{ ird.eventrole.id }}" data-member_id="{{ user.id }}" data-eventrole_id="{{ ird.eventrole.id }}" data-action="attend"  class="event_responder fa fa-plus-circle"></span>
					<span id="eventrole-absent-{{ ird.eventrole.id }}" data-member_id="{{ user.id }}" data-eventrole_id="{{ ird.eventrole.id }}" data-action="absent"  class="event_responder fa fa-times-circle"></span>
			{% endif %}
		{% endif %}
							</span>
						</li>
	{% endfor %}
					</ul>
				</li>
{% endfor %}
			</ul>
		</section>

	</div><!-- 1 of 2 columns -->
	<div class="col-md-6"><!-- 2 of 2 columns -->

		<!--
		<section>
			<h2>Hæfni í boði</h2>
			-->
			<!--Hæfnir sem eru í boði (næstu skref/námskeið í boði?).-->
			<!--
			<ul>
				<li>Frímerkjasöfnun 2</li>
				<li>Kassabílagerð 3 [<time datetime='2011-02-13'>2011.02.31</time>]</li>
			</ul>
			<h2>Endurnýjun</h2>
			<ul>
				<li>Sérhæfð bið (rennur út <time datetime='2028-03-09'>eftir 3 mánuði</time>)</li>
			</ul>
		</section>
		-->

		<section>
  			<h2>Fréttir</h2>
			<a href="http://www.hssr.is">HSSR</a>
			<div id="hssr_news"><span style="color: gray; padding-left: 2em;">hleður...</span></div>

			<a href="http://landsbjorg.is/">Landsbjörg</a>
			<div id="sl_news"><span style="color: gray; padding-left: 2em;">hleður...</span></div>
			<ul>
<!-- Skoða: http://justquick.github.com/django-native-tags/contrib/feeds.html -->
<!-- Skoða: http://www.b-list.org/weblog/2007/dec/09/updates/ -->
		</section>

	</div><!-- 2 of 2 columns -->
</div><!-- row -->

{% endblock %}

{% block datetimestamp %}<time datetime="2013-05-03">3. maí 2013.</time>{% endblock %}
