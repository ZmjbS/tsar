{% extends "tsar.html" %}
{% load bootstrap_toolkit %}

{% block head %}
<script type="text/javascript" src="/static/js/development-bundle/ui/jquery-ui-1.8.21.custom.js"></script>
<script type="text/javascript" src="/static/js/development-bundle/ui/jquery.ui.datepicker.js"></script>
<script type="text/javascript" src="/static/js/jquery-ui-timepicker-addon.js"></script>
<link type="text/css" rel="stylesheet" href="/static/js/css/ui-lightness/jquery-ui-1.8.21.custom.css" />
<script type="text/javascript" src="/static/js/chosen.jquery.min.js"></script>
<link type="text/css" rel="stylesheet" href="/static/css/chosen.css" />
<style>
	/* css for timepicker */
	.ui-timepicker-div .ui-widget-header { margin-bottom: 8px; }
	.ui-timepicker-div .ui-widget-header { margin-bottom: 8px; }
	.ui-timepicker-div dl { text-align: left; }
	.ui-timepicker-div dl dt { height: 25px; margin-bottom: -25px; }
	.ui-timepicker-div dl dd { margin: 0 10px 10px 65px; }
	.ui-timepicker-div td { font-size: 90%; }
	.ui-tpicker-grid-label { background: none; border: none; margin: 0; padding: 0; }
</style>
<style>
	section { overflow: auto; }
	h2 { margin-top: 0; }
	.select-participants, [id*='role-groups-id_'] { width: 100%; }
	/*#tag-event_task, #tag-organiser, #tag-location, #tag-equipment { width: 44em; }*/
	/*#tag-event_task, #tag-organiser, #tag-location, #tag-equipment { width: 100%; }*/
	#tag_organiser_chzn, #tag_event_task_chzn, #tag_location_chzn, #tag_equipment_chzn { width: 100% !important; }
	/*#tag-organiser { width: 8em; } */
	#id_minimum, #id_maximum { width: 2em; }
	th, td { height: 1em; }
	#role_groups_id_template_chzn, #role_groups_id_template_chzn .chzn-drop, #role_groups_id_template_chzn ul li input { width: 100% !important; }

	#id_date_time_begin-label, #id_date_time_end-label { text-align: right; }
	#id_date_time_begin, #id_date_time_end { display: inline; width: 8em; }
	
	.role_entry { background-color: #efefef; padding: .4em; margin-bottom: .4em; }
	.role_entry-title { font-size: 1.6em; padding-top: .3em; }
</style>
<script type="text/javascript">

$(document).ready(function(){
// Datetimepicker
	$('#id_date_time_begin').datetimepicker();
	$('#id_date_time_end').datetimepicker();

// Chosen UI
	$('#role-groups-id_template').chosen();

	$('#tag-organiser').chosen();
	$('#tag-event_task').chosen();
	$('#tag-location').chosen();
	$('#tag-equipment').chosen();

// Bootstrap styling
	$('#id_title').addClass('span6');
	$('#event_type').addClass('span2');
//	$('#tag-organiser').addClass('span2');

/*	$('#id_date_time_begin-label').addClass('span1');
	$('#id_date_time_begin-content').addClass('span2');
	$('#id_date_time_end-label').addClass('span1');
	$('#id_date_time_end-content').addClass('span2');*/
	$('#add_days').addClass('span6');

	$('#id_description').addClass('span12');


// Serialise the input data and submit the form.
	$('form').submit(function() {
		csrf = "{{ csrf_token|escapejs }}"
		console.log('serialising');
		json = JSON.stringify($(this).serializeJSON());
		//console.log(json);
		var posting = $.post("/vidburdur/nyskraning/vista", {'csrfmiddlewaretoken': csrf, 'data': json});
		posting.done(function(data) {
			if (isNaN(parseInt(data))) {
				print_result('Error: '+data,'alert-error');
			} else {
				$('#event_id').val(data);
				print_result('Viðburður númer '+data+' búinn til. Sjá <a href="/vidburdur/'+data+'">síðu viðburðarins</a>','alert-success');
			}
		});
		return false;
	});

	function print_results(message){
		$('#results').show()
		$('#results').html(message)
	}

}); //END READY -----------------------

	function print_result(message,type){
		$('#results').slideDown()
		$('#results').html(message)
		if (type) {
			$('#results').removeClass()
			$('#results').addClass('alert '+type)
		}
	}

	$('.delete-role-entry').live('click',(function(){
		role_id = $(this).attr('id');
		role_title = $(this).parents('.role_entry').find('.role_entry-title').html();
		$(this).parents('.role_entry').remove();
		$('#role-dropdown').append('<li id="'+role_id+'" class="role-tmp"><a>'+role_title+'</a></li>');
	}));

	$('.role-tmp').live('click',(function(){
		role_id = $(this).attr('id');
		role_title = $(this).children('a').html();
		$(this).remove();
	node=	'<div class="role_entry">'
		+			'<div class="role_entry-title" style="float:left">'+role_title+'</div>'
		+			'<input type="hidden" name="role['+role_id+'][id]" value="'+role_id+'" />'
		+					'<div style="float:right"><i id="'+role_id+'" class="delete-role-entry icon-remove-sign pull-right" style="cursor: pointer"></i></div>'
		+					'<div style="float:right; margin-right: .5em;">mest:   <input name="role['+role_id+'][max]" class="span6 role-max" type="number" min="0" value="0" max="999" style="width:2em"/></div>'
		+					'<div style="float:right; margin-right: .5em;">minnst: <input name="role['+role_id+'][min]" class="span6 role-min" type="number" min="0" value="0" max="999" style="width:2em"/></div>'
//		+					'<div>'
//		+						'<input name="role['+role_id+'][closed]" class="btn btn-danger span12" type="button" value="lokað" onclick="$(this).toggleClass(\'btn-danger btn-success\');($(this).val()==\'lokað\')?$(this).val(\'opið\'):$(this).val(\'lokað\');" />'
//		+					'</div>'
		+		'<div>'
		+			'<select name="role['+role_id+'][participants][]" multiple data-placeholder="Veldu þáttakendur" class="select-participants">'
		+				'<optgroup label="Hópar og flokkar">'
		+					'{% for group in groups %}'
		+					'<option value="g{{ group.id }}">{{ group.title }}</option>'
		+					'{% endfor %}'
		+				'</optgroup>'
		+				'<optgroup label="Meðlimir">'
		+					'{% for member in members %}'
		+					'<option value="m{{ member.id }}">{{ member }}</option>'
		+					'{% endfor %}'
		+				'</optgroup>'
		+			'</select>'
		+		'</div>'
		+	'</div>'
		+'</div>'; 
		$('#invite-role-list').append(node);
		$('.select-participants').chosen();
	}));
</script>
{% endblock %}

{% block content %}

<!--
<section style="position: absolute; right: 50px; top: 70px">
	<input type="text" value="Viðburður" /><input type="button" value="Afrita" />
</section>
-->

{% if error_message %}<div id="error_message">{{ error_message }}</div>{% endif %}

<form id="event-creator" action="." method="post">

<div class="third-width" style="height: 100%; ">
<!-- BOÐUN Í HLUTVERK -->
<section class="" style="overflow: visible;">
	<div class="btn-group pull-right" id="event-invite-button">
		<button class="btn dropdown-toggle" data-toggle="dropdown">Bæta við hlutverki <span class="caret"></span> </button>
		<ul id="role-dropdown" class="dropdown-menu">
			{% for role in event_roles %}
			<li class="role-tmp" id="{{ role.id}}"><a>{{ role.title }}</a></li>
			{% endfor %}
		</ul>
	</div>

	<h2 id="event-invite-header">Boðun</h2>

	<div id="invite-role-list">
	</div><!--invite-role-list-->
</section>
</div>

<div class="twothird-width">
<!-- LÝSING -->
<!--
<section class="full-width " id="lysing" tyle="overflow: visible">
-->
<section class="full-width" id="lysing" tyle="overflow: visible">
	<input type="hidden" name="event_id" id="event_id" value="" />
	<div id="event-dates" class="" name="event[date_time_begin]" style="float:right; color: gray;">
		<!--<span id="id_date_time_begin-label">
			{{ form.date_time_begin.label }}
		</span>-->
		<span id="id_date_time_begin-content">
			{{ form.date_time_begin }}
		</span>
		<!-- 〜-->
		<!--<span id="id_date_time_end-label">
			{{ form.date_time_end.label }}
		</span>-->
		<span id="id_date_time_end-content">
			{{ form.date_time_end }}
		</span>
	<!--
		<div id="add_days">
			<input type="button" class="btn" value="Bæta við degi">
			<input type="button" class="btn" value="Bæta við endurtekningum" />
		</div>
	-->
	</div>
<!--
	<h2>Lýsing</h2>
-->
	<div class="row-fluid">
		{{ form.title }}
		<select id="event_type" name="event_type">
			<!--<option value="none">Tegund viðburðar</option>-->
			{% for type in event_types %}
			<option value="{{ type.pk }}">{{ type.title }}</option>
			{% endfor %}
		</select>
	</div>

	<div class="row-fluid">
		{{ form.description }}
	</div>
</section>

<!-- MERKI -->
<section class="half-width" style="overflow: visible">
	<input id="event-tag-button" type="button" class="btn" style="float: right" value="Merkja" data-toggle="button" onclick="$('#merki-content').slideToggle();" />
	<!--<div style="float:left; width:40%; margin:0; padding:0;">-->
		<h2 id="event-tag-header">Merki</h2>
		<div id="merki-content" style="display:none">
			<table style="width: 100%">
				<tr><td>Umsjón:</td><td>
				<select id="tag-organiser" multiple data-placeholder="Merktu umsjónaraðila">
					<option>Landsbjörg</option>
					<option>Önnur sveit</option>
					<option>HSSR</option>
					<option>Einstaklingar</option>
					<optgroup label="Hópur">
						{% for group in groups %}
						<option>{{ group.title }}</option>
						{% endfor %}
					</optgroup>
				</select>
					</td>
				</tr>
				<tr>
					<td style="width: 6em;">Verkefni:</td><td>
					<select id="tag-event_task" multiple data-placeholder="Merktu verkefni æfingarinnar">
						<option>Björgun</option>
						<option>Böruburður</option>
						<option>Búðavinna</option>
						<option>Fjallabjörgun</option>
						<option>Flugvélarútköll (flugvél í vanda)</option>
						<option>Fyrstu hjálp beitt</option>  
						<option>Hópslys</option>
						<option>Leit (almenn)</option>
						<option>Leit (sérhæfð)</option>
						<option>Línuvinna</option>
						<option>Óveðursaðstoð</option>
						<option>Sjúkraflutningur</option>
						<option>Snjóflóð</option>
						<option>Veitt aðstoð í ófærð</option>
					</select>
					</td>
				</tr>
				<tr>
					<td>Aðstæður:</td><td>
					<select id="tag-location" multiple data-placeholder="Merktu aðstæðurnar">
						<option>Fjalllendi</option>
						<option>Fjara</option>
						<option>Flatlendi</option>
						<option>Innanbæjar</option>
						<option>Jökull</option>
						<option>Óbyggðir</option>
						<option>Straumvatn</option>
					</td>
				</tr>
				<tr>
					<td>Tækjanotkun:</td>
					<td><select id="tag-equipment" multiple data-placeholder="Merktu tækin sem voru notuð">
						<option>Reykur 1</option>
						<option>Reykur 2</option>
						<option>Reykur 3</option>
						<option>Reykur 4</option>
						<option>Reykur Boli</option>
						<option>Reykur 6</option>
						<option>Reykur 7</option>
						<option>Vélsleðar</option>
					</select></td>
				</tr>
			</table>
		</div>
	<!--</div>--><!-- 50% div -->
</section>
<!-- LANDFRÆÐILEGAR UPPLÝSINGAR -->
<section class="half-width" id="stadsetningar">
	<!--<div style="float:left; width:60%; margin:0; padding:0;">-->
		<div style="float:right; vertical-align: bottom;">
			<input id="event-geo-button" type="button" class="btn" data-toggle="button" onclick="$('#stadsetning-content').slideToggle();" value="Staðsetja" />
		</div>
		<h2 id="event-geo-header">Staðsetning</h2>
		<div id="stadsetning-content" style="display:none">
	
			<div style="float:right;"><img src="/static/img/hengill-husmuli.png" width="200" height="200" alt="Kort af svæðinu." /></div>
			<table>
				<tr><th>Lengd</th><th>Breidd</th><th colspan="2">Lýsing</th></tr>
<!--
				<tr><td>N 64°34,392'</td><td>V 21°39,291'</td><td colspan="2">Upphafsstaður æfingar.</td></tr>
				<tr><td>N 65°01,039'</td><td>V 21°33,029'</td><td colspan="2">Söfnunarsvæði slasaðra.</td></tr>
-->
				<tr>
					<td><input type="text" placeholder="lengd" style="width: 6em" /></td>
					<td><input type="text" placeholder="breidd" style="width: 6em" /></td>
					<td><input type="text" style="width:100%" placeholder="Lýsing" /></td>
					<td><input type="button" class="btn" value="Bæta við" style="margin-bottom:10px; margin-left: 10px;"/></td>
				</tr>
				<tr>
					<td colspan="3"><input type="text" placeholder="GPX/KML-skrá" style="min-width:30em" /></td><td><input type="button" class="btn" value="Hlaða upp" style="margin-bottom: 10px;"/></span></td>
				</tr>
			</table>
		</div>
	<!--</div> 50% div -->
</section>

</div>

<div class="full-width">
<section class="full-width" id="create-event">
<div class="alert" style="float: left; padding-top: 4px; padding-bottom: 4px; margin-bottom: 0px; display:none" id="results"></div>
	<!--<input id="create-event-button" type="button" class="btn btn-primary pull-right" value="Vista viðburð" />-->
	<button id="create-event-button" class="btn btn-primary pull-right">Vista viðburð</button>
</section>
</div>

</form>

{% endblock %}
